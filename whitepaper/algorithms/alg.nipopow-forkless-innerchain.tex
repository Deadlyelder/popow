\begin{algorithm}[H]
    \caption{\label{alg.nipopow-forkless-construct-innerchain}The modified constructInnerChain
    that allows for a forkless upgrade.}
    \begin{algorithmic}[1]
        \Function{\sf constructInnerChain}{$\chain, \mu, boundary,
            \textsf{reallink}, \textsf{blockById}$}
            \Let{B}{\chain[-1]}
            \Let{\textsf{aux}}{[B]}
            \Let{\pi}{[B]}
            \While{$B \neq boundary$}
                \If{$B.\textsf{interlink}[\mu] = \textsf{reallink}[blockid(B)][\mu]$}
                    \Let{blockid}{B.\textsf{interlink}[\mu]}
                    \Let{B}{\textsf{blockById}(blockid)}
                \Else
                    \Comment{Invalid interlink}
                    \Let{B}{\textsf{blockById}(B.\textsf{interlink}[0])}
                \EndIf
                \If{$\textsf{lvl}(B) = \mu$}
                    \State{$\pi$.append($B$)}
                \EndIf
                \State{\textsf{aux}.append($B$)}
            \EndWhile
            \State\Return{$\pi$, aux}
        \EndFunction
    \vskip8pt
    \end{algorithmic}
\end{algorithm}
