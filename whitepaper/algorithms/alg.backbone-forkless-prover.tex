\begin{figure}[t]
\begin{algorithm}[H]
    \caption{\label{alg.backbone-forkless-prover} The modified prover that
        allows for a forkless upgrade.}
    \begin{algorithmic}[1]
     \Statex
        \Let\chain{[\textsf{Genesis}]}
        \Let{\textsf{realInterlink}}{\{\}}
        \Let{\textsf{blockById}}{\{\}}
        \Let{\textsf{genesisId}}{\textsf{blockid}(\textsf{Genesis})}
        \Let{\textsf{blockById}[\textsf{genesisId}]}{\textsf{Genesis}}
        \Let{\textsf{realInterlink}[\textsf{genesisId}]}{[\textsf{Genesis}]}
        \While{\textsc{True}}
            \Let{\tilde\chain}{\mathsf{maxvalid}( \chain, \mbox{any chain $\chain'$ found in  \textsc{Receive}()}) }
            \Let{\textsf{new}}{[]}
            \For{$i = |\chain| - 1$ down to $0$}
                \If{$\chain[i] \in \textsf{realInterlink}$}
                    \Let{B'}{\chain[i]}
                    \Let{\textsf{interlink}}{\textsf{realInterlink}[B']}
                    \State\textbf{break}
                \EndIf
                \State\textsf{new.append}{$(\chain[i])$}
            \EndFor
            \For{$B \in \textsf{new}$}
                \For{$\mu = 0$ to $\textsf{lvl}(B')$}
                    \Let{\textsf{interlink}[\mu]}{\textsf{blockid}(B')}
                \EndFor
                \Let{B'}{B}
                \Let{\textsf{blockById}[blockid(B)]}{B}
                \Let{\textsf{realInterlink}[B]}{\textsf{interlink}}
            \EndFor
            \If{$\textsc{Input}()\mbox{ contains }\textsc{ReadProof}$}
                \Let{\overline \Pi}{\textsf{Prove}_q(\chain, \textsf{realInterlink}, \textsf{blockById})}
                \State\textsc{Diffuse}{$(\overline \Pi)$}
            \Else
                \State\textsc{Diffuse}{$(\bot)$}
            \EndIf
        \EndWhile
        \vskip8pt
    \end{algorithmic}
\end{algorithm}
\end{figure}
