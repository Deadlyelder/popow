\section{Succinctness}

We now move on to prove that our construction produces succinct proofs.

\begin{theorem}
    \label{thm.few-levels}
    The number of superblock levels which have at least $m$ blocks are at most
    $\log(|S|)$, where $S$ is the set of all blocks produced, with overwhelming
    probability in $m$.
\end{theorem}

\begin{proof}
    Let $S$ be the set of all blocks successfully produced by the honest
    parties or the adversary. Because each block id is generated by the random
    oracle, the probability that it is less than $T 2^{-\mu}$ is
    $2^{-\mu}$. These are independent Bernoulli trials. For each block
    $B \in S$, define $X^{\mu}_B \in \{0, 1\}$ to be the random variable
    indicating whether the block belongs to superblock level $\mu$ and let
    $D_\mu$ indicate their sum, which is a Binomial distribution with
    parameters $(|S|, 2^{-\mu})$ and expected value $E[D_{\mu}] =
    |S| 2^{-\mu}$.

    For level $\mu$ to exist in any valid proof, at least $m$ blocks of level
    $\mu$ must have been produced by the honest parties or the adversary. We
    will now show that $m$ blocks of level $\mu = \log(|S|)$ are produced with
    negligible probability in $m$. For this $\mu$ we have that $E[D_\mu] = 1$.

    As all of the $X^{\mu}$ are independent, we can apply a Binomial Chernoff
    bound to the probability of the sum. Therefore we have:

    \begin{align*}
        \Pr[D_\mu \geq (1 + \Delta)E[D_\mu]] &\leq \exp(-\frac{\Delta^2}{2 + \Delta}E[D_\mu]) \\
        \Pr[D_\mu \geq 1 + \Delta] &\leq \exp(-\frac{\Delta^2}{2 + \Delta})
    \end{align*}

    Requiring $1 + \Delta = m$, we have:

    \begin{align*}
        \Pr[D_\mu \geq m] &\leq \exp(-\frac{(m - 1)^2}{m + 1})
    \end{align*}

    This is negligible in $m$.
\end{proof}

\begin{theorem}
    \label{thm.large-expansion}
    Given an honest $(\mu - 1)$-level superchain of at least $4m$ blocks
    starting at block $B$ and ending at block $B'$, the respective $\mu$-level
    superchain which covers the same span of blocks has more than $m$ blocks,
    with overwhelming probability in $m$.
\end{theorem}
\begin{proof}
    Assume the $(\mu - 1)$-level superchain had $4m$ blocks. Because each block
    of level $\mu - 1$ was generated as a query to the random oracle, it
    constitutes an independent Bernoulli trial and the number of blocks in
    level $\mu$, namely $\pi[\mu]$ is a Binomial distribution with parameters
    $(4m, 1/2)$ and expected value $2m$. Applying a Chernoff bound to the
    distribution, we have that:

    \begin{align*}
            \Pr[|\pi[\mu]| = m] &\leq \Pr[|\pi[\mu]| \leq m]&&\\
           = \Pr[|\pi[\mu]| \leq (1 - \frac{1}{2})2m] &\leq \exp(-\frac{(1/2)^2}{2} 2m)&&\\
             &\leq \exp(-\frac{m}{4})&&
    \end{align*}

    This is negligible in $m$. This probability bounds the probability of fewer
    than $m$ blocks occurring in the $\mu$ level restriction of $(\mu -
    1)$-level superchains of more than $4m$ blocks.
\end{proof}

\begin{corollary}
    \label{crly.small-support}
    Given an honest $\mu$-level superchain with $m$ blocks starting at block
    $B$ and ending at block $B'$, the respective $(\mu - 1)$-level superchain
    starting at block $B$ and ending at block $B'$ has fewer than $4m$ blocks,
    with overwhelming probability in $m$.
\end{corollary}
\begin{proof}
    Assume the $(\mu - 1)$-level superchain had at least $4m$ blocks. Then by
    Theorem~\ref{thm.large-expansion} it follows that more than $m$ blocks
    exist in level $\mu$ with overwhelming probability in $m$, which is a
    contradiction.
\end{proof}

\begin{theorem}
    \label{thm.succinctness}
    Non-interactive proofs-of-proof-of-work produced by honest provers on
    honest chains are succinct, with overwhelming probability in $m$.
\end{theorem}
\begin{proof}
    Assume $\chain$ is the honest parties chain. From \ref{thm.few-levels}, the
    number of levels in the NIPoPoW is at most $\log(|\chain|)$ with
    overwhelming probability in $m$.

    First, observe that the count of blocks in the highest level will be less
    than $4m$ from Theorem~\ref{thm.small-expansion}; otherwise a higher
    superblock level would exist. Then for the $m$-long suffix of each
    superchain of level $\mu$, the supporting superchain of level $\mu - 1$
    will have at most $4m$ blocks from Corollary~\ref{crly.small-support}.

    Therefore the size of the proof is $4m \log(|\chain|)$, which is succinct.
\end{proof}

% \subsection{Slow-down attacks}
%
% We have proven that honest provers working on honest chains always produce succinct
% proofs. We observe that this is an improvement over \cite{KLS}. We notice that
% their construction is vulnerable to an adversary which can cause honest provers
% working on honest chains to produce non-succinct proofs, and their succinctness
% argument works only in the optimistic case where all provers are honest. We
% term this a ``slow-down'' attack.
%
% The attack occurs when an adversarial prover produces a proof which includes
% some adversarially mined blocks. This adversarial proof is succinct, yet it
% causes honest provers working on completely honest chains to produce long
% proofs. Specifically, the adversary works as follows: After the honest chain
% has grown to a considerable length, she starts mining $m$ blocks starting from
% the Genesis block. After having mined $m$ blocks, the adversary produces a
% succinct proof of $m$ blocks at level $0$ and sends it to the verifier. The
% honest parties produce a succinct proof of higher level as usual. The verifier,
% comparing the two proofs, observes that the lowest common ancestor of the two
% proofs is the Genesis block. Hence, it requests the honest chain of level $0$
% starting from Genesis. However, this is nothing but the whole blockchain,
% requiring the honest parties to send a large amount of data.
%
% Interestingly, this attack is an amplification attack: While the adversary is
% only required to send a small amount of data, the honest parties are forced to
% send large amounts of data. Furthermore, observe that the adversary does not
% even have to mine the first $m$ blocks; instead, they can produce the first $m$
% honest blocks of the blockchain. If the highest superblock level of at least
% $m$ blocks of the honest chain is high enough, these $m$ blocks will not have a
% common block with the honest proof.
